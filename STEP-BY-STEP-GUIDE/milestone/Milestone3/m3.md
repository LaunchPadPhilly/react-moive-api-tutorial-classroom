## ðŸŽ¬ Milestone 3: Movie Details & Favorites (1 day)

### Step 13: Create Movie Detail Hook

Create `src/hooks/useMovieDetail.js`:
```javascript
import { useQuery } from '@tanstack/react-query';
import { omdbApi } from '../services/omdbApi';

export const useMovieDetail = (imdbID) => {
  return useQuery({
    queryKey: ['movie', imdbID],
    queryFn: () => omdbApi.getMovieDetails(imdbID),
    staleTime: 1000 * 60 * 5, // 5 minutes
  });
};
```

### Step 14: Create Favorites Management

Create `src/hooks/useFavorites.js`:
```javascript
import { useState, useEffect } from 'react';

const FAVORITES_KEY = 'movieapp:favorites:v1';

export const useFavorites = () => {
  const [favorites, setFavorites] = useState([]);

  useEffect(() => {
    const stored = localStorage.getItem(FAVORITES_KEY);
    if (stored) {
      try {
        setFavorites(JSON.parse(stored));
      } catch (error) {
        console.error('Failed to parse favorites from localStorage:', error);
        localStorage.removeItem(FAVORITES_KEY);
      }
    }
  }, []);

  const addToFavorites = (imdbID) => {
    const newFavorite = {
      imdbID,
      addedAt: new Date().toISOString(),
    };
    
    const updatedFavorites = [newFavorite, ...favorites.filter(f => f.imdbID !== imdbID)];
    setFavorites(updatedFavorites);
    localStorage.setItem(FAVORITES_KEY, JSON.stringify(updatedFavorites));
  };

  const removeFromFavorites = (imdbID) => {
    const updatedFavorites = favorites.filter(f => f.imdbID !== imdbID);
    setFavorites(updatedFavorites);
    localStorage.setItem(FAVORITES_KEY, JSON.stringify(updatedFavorites));
  };

  const isFavorite = (imdbID) => {
    return favorites.some(f => f.imdbID === imdbID);
  };

  return {
    favorites,
    addToFavorites,
    removeFromFavorites,
    isFavorite,
  };
};
```

### Step 15: Create Movie Detail Components

Create `src/components/FavoriteButton.jsx`:
```jsx
import { HeartIcon } from '@heroicons/react/24/outline';
import { HeartIcon as HeartSolidIcon } from '@heroicons/react/24/solid';

export default function FavoriteButton({ isFavorite, onToggle, disabled }) {
  return (
    <button
      onClick={onToggle}
      disabled={disabled}
      className={`flex items-center px-4 py-2 rounded-md font-medium transition-colors ${
        isFavorite
          ? 'bg-red-100 text-red-700 hover:bg-red-200'
          : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
      } focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50`}
      aria-label={isFavorite ? 'Remove from favorites' : 'Add to favorites'}
    >
      {isFavorite ? (
        <HeartSolidIcon className="h-5 w-5 mr-2" />
      ) : (
        <HeartIcon className="h-5 w-5 mr-2" />
      )}
      {isFavorite ? 'Remove from Favorites' : 'Add to Favorites'}
    </button>
  );
}
```

### Step 16: Update Movie Detail Page

Update `src/pages/MovieDetailPage.jsx`:
```jsx
import { useParams, Link } from 'react-router-dom';
import { ArrowLeftIcon } from '@heroicons/react/24/outline';
import { useMovieDetail } from '../hooks/useMovieDetail';
import { useFavorites } from '../hooks/useFavorites';
import LoadingSpinner from '../components/LoadingSpinner';
import FavoriteButton from '../components/FavoriteButton';

export default function MovieDetailPage() {
  const { imdbID } = useParams();
  const { data: movie, isLoading, error } = useMovieDetail(imdbID!);
  const { isFavorite, addToFavorites, removeFromFavorites } = useFavorites();

  const handleFavoriteToggle = () => {
    if (!movie) return;
    
    if (isFavorite(movie.imdbID)) {
      removeFromFavorites(movie.imdbID);
    } else {
      addToFavorites(movie.imdbID);
    }
  };

  if (isLoading) {
    return <LoadingSpinner />;
  }

  if (error || !movie) {
    return (
      <div className="text-center py-12">
        <div className="text-6xl mb-4">ðŸ˜•</div>
        <h2 className="text-xl font-semibold text-gray-900 mb-2">
          Movie not found
        </h2>
        <p className="text-gray-600 mb-4">
          The movie you're looking for could not be loaded.
        </p>
        <Link
          to="/"
          className="inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500"
        >
          <ArrowLeftIcon className="h-4 w-4 mr-2" />
          Back to Search
        </Link>
      </div>
    );
  }

  const posterUrl = movie.Poster !== 'N/A' ? movie.Poster : null;

  return (
    <div className="space-y-6">
      <Link
        to="/"
        className="inline-flex items-center text-blue-600 hover:text-blue-800 focus:outline-none focus:ring-2 focus:ring-blue-500 rounded"
      >
        <ArrowLeftIcon className="h-4 w-4 mr-2" />
        Back to Search
      </Link>

      <div className="bg-white rounded-lg shadow-lg overflow-hidden">
        <div className="md:flex">
          <div className="md:w-1/3">
            {posterUrl ? (
              <img
                src={posterUrl}
                alt={`${movie.Title} poster`}
                className="w-full h-96 md:h-full object-cover"
              />
            ) : (
              <div className="w-full h-96 md:h-full bg-gray-200 flex items-center justify-center text-gray-500">
                <div className="text-center">
                  <div className="text-6xl mb-4">ðŸŽ¬</div>
                  <div>No Poster Available</div>
                </div>
              </div>
            )}
          </div>
          
          <div className="md:w-2/3 p-6">
            <div className="flex justify-between items-start mb-4">
              <div>
                <h1 className="text-3xl font-bold text-gray-900 mb-2">
                  {movie.Title}
                </h1>
                <p className="text-gray-600">
                  {movie.Year} â€¢ {movie.Type} â€¢ {movie.Rated}
                </p>
              </div>
              <FavoriteButton
                isFavorite={isFavorite(movie.imdbID)}
                onToggle={handleFavoriteToggle}
              />
            </div>

            {movie.Plot && (
              <div className="mb-6">
                <h2 className="text-lg font-semibold text-gray-900 mb-2">Plot</h2>
                <p className="text-gray-700 leading-relaxed">{movie.Plot}</p>
              </div>
            )}

            <div className="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
              {movie.Director && (
                <div>
                  <span className="font-medium text-gray-900">Director:</span>
                  <span className="ml-2 text-gray-700">{movie.Director}</span>
                </div>
              )}
              
              {movie.Actors && (
                <div>
                  <span className="font-medium text-gray-900">Cast:</span>
                  <span className="ml-2 text-gray-700">{movie.Actors}</span>
                </div>
              )}
              
              {movie.Genre && (
                <div>
                  <span className="font-medium text-gray-900">Genre:</span>
                  <span className="ml-2 text-gray-700">{movie.Genre}</span>
                </div>
              )}
              
              {movie.Runtime && (
                <div>
                  <span className="font-medium text-gray-900">Runtime:</span>
                  <span className="ml-2 text-gray-700">{movie.Runtime}</span>
                </div>
              )}
              
              {movie.Released && (
                <div>
                  <span className="font-medium text-gray-900">Released:</span>
                  <span className="ml-2 text-gray-700">{movie.Released}</span>
                </div>
              )}
              
              {movie.Language && (
                <div>
                  <span className="font-medium text-gray-900">Language:</span>
                  <span className="ml-2 text-gray-700">{movie.Language}</span>
                </div>
              )}
            </div>

            {movie.Ratings && movie.Ratings.length > 0 && (
              <div className="mt-6">
                <h3 className="text-lg font-semibold text-gray-900 mb-2">Ratings</h3>
                <div className="space-y-2">
                  {movie.Ratings.map((rating, index) => (
                    <div key={index} className="flex justify-between">
                      <span className="text-gray-700">{rating.Source}:</span>
                      <span className="font-medium text-gray-900">{rating.Value}</span>
                    </div>
                  ))}
                </div>
              </div>
            )}
          </div>
        </div>
      </div>
    </div>
  );
}
```

### Step 17: Update Favorites Page

Update `src/pages/FavoritesPage.jsx`:
```jsx
import { Link } from 'react-router-dom';
import { useQuery } from '@tanstack/react-query';
import { useFavorites } from '../hooks/useFavorites';
import { omdbApi } from '../services/omdbApi';
import MovieCard from '../components/MovieCard';
import LoadingSpinner from '../components/LoadingSpinner';

export default function FavoritesPage() {
  const { favorites } = useFavorites();

  const { data: favoriteMovies, isLoading } = useQuery({
    queryKey: ['favorites', favorites.map(f => f.imdbID)],
    queryFn: async () => {
      if (favorites.length === 0) return [];
      
      const moviePromises = favorites.map(favorite => 
        omdbApi.getMovieDetails(favorite.imdbID)
      );
      
      return Promise.all(moviePromises);
    },
    enabled: favorites.length > 0,
  });

  if (isLoading) {
    return <LoadingSpinner />;
  }

  return (
    <div className="space-y-6">
      <h1 className="text-3xl font-bold text-gray-900">Your Favorites</h1>

      {favorites.length === 0 ? (
        <div className="text-center py-12">
          <div className="text-6xl mb-4">ðŸ’™</div>
          <h2 className="text-xl font-semibold text-gray-900 mb-2">
            No favorites yet
          </h2>
          <p className="text-gray-600 mb-6">
            Start building your collection by searching for movies and adding them to your favorites.
          </p>
          <Link
            to="/"
            className="inline-flex items-center px-6 py-3 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500"
          >
            Browse Movies
          </Link>
        </div>
      ) : (
        <div>
          <p className="text-gray-600 mb-6">
            You have {favorites.length} favorite movie{favorites.length !== 1 ? 's' : ''}
          </p>
          
          {favoriteMovies && (
            <div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4">
              {favoriteMovies.map((movie) => (
                <MovieCard key={movie.imdbID} movie={movie} />
              ))}
            </div>
          )}
        </div>
      )}
    </div>
  );
}
```

### Step 18: Test Movie Details and Favorites

```bash
npm run dev
```

Test that:
- Clicking a movie card navigates to detail page
- Movie details load and display correctly
- Favorite button works (add/remove)
- Favorites persist after page refresh
- Favorites page shows saved movies
- Navigation works correctly

---

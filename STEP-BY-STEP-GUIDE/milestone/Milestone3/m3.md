## ðŸŽ¬ Milestone 3: Movie Details & Favorites (1 day)

### Step 13: Create Movie Detail Hook

Create `src/hooks/useMovieDetail.js`:
```javascript
import { useQuery } from '@tanstack/react-query';
import { omdbApi } from '../services/omdbApi';

export const useMovieDetail = (imdbID) => {
  return useQuery({
    queryKey: ['movie', imdbID],
    queryFn: () => omdbApi.getMovieDetails(imdbID),
    staleTime: 1000 * 60 * 5, // 5 minutes
  });
};
```

### Step 14: Create Favorites Management

Create `src/hooks/useFavorites.js`:
```javascript
import { useState, useEffect } from 'react';

const FAVORITES_KEY = 'movieapp:favorites:v1';

export const useFavorites = () => {
  const [favorites, setFavorites] = useState([]);

  useEffect(() => {
    const stored = localStorage.getItem(FAVORITES_KEY);
    if (stored) {
      try {
        setFavorites(JSON.parse(stored));
      } catch (error) {
        console.error('Failed to parse favorites from localStorage:', error);
        localStorage.removeItem(FAVORITES_KEY);
      }
    }
  }, []);

  const addToFavorites = (imdbID) => {
    const newFavorite = {
      imdbID,
      addedAt: new Date().toISOString(),
    };
    
    const updatedFavorites = [newFavorite, ...favorites.filter(f => f.imdbID !== imdbID)];
    setFavorites(updatedFavorites);
    localStorage.setItem(FAVORITES_KEY, JSON.stringify(updatedFavorites));
  };

  const removeFromFavorites = (imdbID) => {
    const updatedFavorites = favorites.filter(f => f.imdbID !== imdbID);
    setFavorites(updatedFavorites);
    localStorage.setItem(FAVORITES_KEY, JSON.stringify(updatedFavorites));
  };

  const isFavorite = (imdbID) => {
    return favorites.some(f => f.imdbID === imdbID);
  };

  return {
    favorites,
    addToFavorites,
    removeFromFavorites,
    isFavorite,
  };
};
```

### Step 15: Create Movie Detail Components

Create `src/components/FavoriteButton.jsx`:
```jsx
import { HeartIcon } from '@heroicons/react/24/outline';
import { HeartIcon as HeartSolidIcon } from '@heroicons/react/24/solid';

export default function FavoriteButton({ isFavorite, onToggle, disabled }) {
  return (
    <button
      onClick={onToggle}
      disabled={disabled}
      className={`flex items-center px-4 py-2 rounded-md font-medium transition-colors ${
        isFavorite
          ? 'bg-red-100 text-red-700 hover:bg-red-200'
          : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
      } focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50`}
      aria-label={isFavorite ? 'Remove from favorites' : 'Add to favorites'}
    >
      {isFavorite ? (
        <HeartSolidIcon className="h-5 w-5 mr-2" />
      ) : (
        <HeartIcon className="h-5 w-5 mr-2" />
      )}
      {isFavorite ? 'Remove from Favorites' : 'Add to Favorites'}
    </button>
  );
}
```

### Step 16: Update Movie Detail Page

Create `src/styles/MovieDetailPage.css` (if not already created):
```css
.movie-detail-page {
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
}

.back-link {
  display: inline-flex;
  align-items: center;
  color: #3b82f6;
  text-decoration: none;
  transition: color 0.2s ease;
}

.back-link:hover {
  color: #1d4ed8;
}

.back-link:focus {
  outline: none;
  box-shadow: 0 0 0 2px #3b82f6;
  border-radius: 0.25rem;
}

.back-icon {
  width: 1rem;
  height: 1rem;
  margin-right: 0.5rem;
}

.movie-detail-card {
  background: white;
  border-radius: 0.5rem;
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
  overflow: hidden;
}

.movie-detail-container {
  display: flex;
  flex-direction: column;
}

@media (min-width: 768px) {
  .movie-detail-container {
    flex-direction: row;
  }
}

.movie-poster-section {
  width: 100%;
}

@media (min-width: 768px) {
  .movie-poster-section {
    width: 33.333333%;
  }
}

.movie-detail-poster {
  width: 100%;
  height: 24rem;
  object-fit: cover;
}

@media (min-width: 768px) {
  .movie-detail-poster {
    height: 100%;
  }
}

.movie-poster-placeholder-large {
  width: 100%;
  height: 24rem;
  background-color: #e5e7eb;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #6b7280;
}

@media (min-width: 768px) {
  .movie-poster-placeholder-large {
    height: 100%;
  }
}

.movie-poster-placeholder-large-content {
  text-align: center;
}

.movie-poster-placeholder-large-icon {
  font-size: 3.75rem;
  margin-bottom: 1rem;
}

.movie-info-section {
  width: 100%;
  padding: 1.5rem;
}

@media (min-width: 768px) {
  .movie-info-section {
    width: 66.666667%;
  }
}

.movie-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 1rem;
  flex-wrap: wrap;
  gap: 1rem;
}

.movie-title-section {
  flex: 1;
}

.movie-detail-title {
  font-size: 1.875rem;
  font-weight: 700;
  color: #111827;
  margin-bottom: 0.5rem;
}

.movie-meta-info {
  color: #6b7280;
}

.movie-plot-section {
  margin-bottom: 1.5rem;
}

.section-title {
  font-size: 1.125rem;
  font-weight: 600;
  color: #111827;
  margin-bottom: 0.5rem;
}

.plot-text {
  color: #374151;
  line-height: 1.625;
}

.movie-details-grid {
  display: grid;
  grid-template-columns: repeat(1, minmax(0, 1fr));
  gap: 1rem;
  font-size: 0.875rem;
}

@media (min-width: 768px) {
  .movie-details-grid {
    grid-template-columns: repeat(2, minmax(0, 1fr));
  }
}

.detail-item {
  display: flex;
  flex-direction: column;
}

.detail-label {
  font-weight: 500;
  color: #111827;
  margin-bottom: 0.25rem;
}

.detail-value {
  color: #374151;
}

.ratings-section {
  margin-top: 1.5rem;
}

.ratings-list {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.rating-item {
  display: flex;
  justify-content: space-between;
}

.rating-source {
  color: #374151;
}

.rating-value {
  font-weight: 500;
  color: #111827;
}

.error-state {
  text-align: center;
  padding: 3rem 0;
}

.error-icon {
  font-size: 3.75rem;
  margin-bottom: 1rem;
}

.error-title {
  font-size: 1.25rem;
  font-weight: 600;
  color: #111827;
  margin-bottom: 0.5rem;
}

.error-text {
  color: #6b7280;
  margin-bottom: 1rem;
}

.error-button {
  display: inline-flex;
  align-items: center;
  padding: 0.5rem 1rem;
  background-color: #3b82f6;
  color: white;
  border-radius: 0.375rem;
  text-decoration: none;
  transition: background-color 0.2s ease;
}

.error-button:hover {
  background-color: #2563eb;
}

.error-button:focus {
  outline: none;
  box-shadow: 0 0 0 2px #3b82f6;
}
```

Update `src/pages/MovieDetailPage.jsx`:
```jsx
import { useParams, Link } from 'react-router-dom';
import { ArrowLeftIcon } from '@heroicons/react/24/outline';
import { useMovieDetail } from '../hooks/useMovieDetail';
import { useFavorites } from '../hooks/useFavorites';
import LoadingSpinner from '../components/LoadingSpinner';
import FavoriteButton from '../components/FavoriteButton';
import '../styles/MovieDetailPage.css';

export default function MovieDetailPage() {
  const { imdbID } = useParams();
  const { data: movie, isLoading, error } = useMovieDetail(imdbID);
  const { isFavorite, addToFavorites, removeFromFavorites } = useFavorites();

  const handleFavoriteToggle = () => {
    if (!movie) return;

    if (isFavorite(movie.imdbID)) {
      removeFromFavorites(movie.imdbID);
    } else {
      addToFavorites(movie.imdbID);
    }
  };

  if (isLoading) {
    return <LoadingSpinner />;
  }

  if (error || !movie) {
    return (
      <div className="error-state">
        <div className="error-icon">ðŸ˜•</div>
        <h2 className="error-title">
          Movie not found
        </h2>
        <p className="error-text">
          The movie you're looking for could not be loaded.
        </p>
        <Link to="/" className="error-button">
          <ArrowLeftIcon className="back-icon" />
          Back to Search
        </Link>
      </div>
    );
  }

  const posterUrl = movie.Poster !== 'N/A' ? movie.Poster : null;

  return (
    <div className="movie-detail-page">
      <Link to="/" className="back-link">
        <ArrowLeftIcon className="back-icon" />
        Back to Search
      </Link>

      <div className="movie-detail-card">
        <div className="movie-detail-container">
          <div className="movie-poster-section">
            {posterUrl ? (
              <img
                src={posterUrl}
                alt={`${movie.Title} poster`}
                className="movie-detail-poster"
              />
            ) : (
              <div className="movie-poster-placeholder-large">
                <div className="movie-poster-placeholder-large-content">
                  <div className="movie-poster-placeholder-large-icon">ðŸŽ¬</div>
                  <div>No Poster Available</div>
                </div>
              </div>
            )}
          </div>

          <div className="movie-info-section">
            <div className="movie-header">
              <div className="movie-title-section">
                <h1 className="movie-detail-title">
                  {movie.Title}
                </h1>
                <p className="movie-meta-info">
                  {movie.Year} â€¢ {movie.Type} â€¢ {movie.Rated}
                </p>
              </div>
              <FavoriteButton
                isFavorite={isFavorite(movie.imdbID)}
                onToggle={handleFavoriteToggle}
              />
            </div>

            {movie.Plot && (
              <div className="movie-plot-section">
                <h2 className="section-title">Plot</h2>
                <p className="plot-text">{movie.Plot}</p>
              </div>
            )}

            <div className="movie-details-grid">
              {movie.Director && (
                <div className="detail-item">
                  <span className="detail-label">Director</span>
                  <span className="detail-value">{movie.Director}</span>
                </div>
              )}

              {movie.Actors && (
                <div className="detail-item">
                  <span className="detail-label">Cast</span>
                  <span className="detail-value">{movie.Actors}</span>
                </div>
              )}

              {movie.Genre && (
                <div className="detail-item">
                  <span className="detail-label">Genre</span>
                  <span className="detail-value">{movie.Genre}</span>
                </div>
              )}

              {movie.Runtime && (
                <div className="detail-item">
                  <span className="detail-label">Runtime</span>
                  <span className="detail-value">{movie.Runtime}</span>
                </div>
              )}

              {movie.Released && (
                <div className="detail-item">
                  <span className="detail-label">Released</span>
                  <span className="detail-value">{movie.Released}</span>
                </div>
              )}

              {movie.Language && (
                <div className="detail-item">
                  <span className="detail-label">Language</span>
                  <span className="detail-value">{movie.Language}</span>
                </div>
              )}
            </div>

            {movie.Ratings && movie.Ratings.length > 0 && (
              <div className="ratings-section">
                <h3 className="section-title">Ratings</h3>
                <div className="ratings-list">
                  {movie.Ratings.map((rating, index) => (
                    <div key={index} className="rating-item">
                      <span className="rating-source">{rating.Source}</span>
                      <span className="rating-value">{rating.Value}</span>
                    </div>
                  ))}
                </div>
              </div>
            )}
          </div>
        </div>
      </div>
    </div>
  );
}
```

### Step 17: Update Favorites Page

Update `src/pages/FavoritesPage.jsx`:
```jsx
import { Link } from 'react-router-dom';
import { useQuery } from '@tanstack/react-query';
import { useFavorites } from '../hooks/useFavorites';
import { omdbApi } from '../services/omdbApi';
import MovieCard from '../components/MovieCard';
import LoadingSpinner from '../components/LoadingSpinner';

export default function FavoritesPage() {
  const { favorites } = useFavorites();

  const { data: favoriteMovies, isLoading } = useQuery({
    queryKey: ['favorites', favorites.map(f => f.imdbID)],
    queryFn: async () => {
      if (favorites.length === 0) return [];
      
      const moviePromises = favorites.map(favorite => 
        omdbApi.getMovieDetails(favorite.imdbID)
      );
      
      return Promise.all(moviePromises);
    },
    enabled: favorites.length > 0,
  });

  if (isLoading) {
    return <LoadingSpinner />;
  }

  return (
    <div className="space-y-6">
      <h1 className="text-3xl font-bold text-gray-900">Your Favorites</h1>

      {favorites.length === 0 ? (
        <div className="text-center py-12">
          <div className="text-6xl mb-4">ðŸ’™</div>
          <h2 className="text-xl font-semibold text-gray-900 mb-2">
            No favorites yet
          </h2>
          <p className="text-gray-600 mb-6">
            Start building your collection by searching for movies and adding them to your favorites.
          </p>
          <Link
            to="/"
            className="inline-flex items-center px-6 py-3 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500"
          >
            Browse Movies
          </Link>
        </div>
      ) : (
        <div>
          <p className="text-gray-600 mb-6">
            You have {favorites.length} favorite movie{favorites.length !== 1 ? 's' : ''}
          </p>
          
          {favoriteMovies && (
            <div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4">
              {favoriteMovies.map((movie) => (
                <MovieCard key={movie.imdbID} movie={movie} />
              ))}
            </div>
          )}
        </div>
      )}
    </div>
  );
}
```

### Step 18: Test Movie Details and Favorites

```bash
npm run dev
```

Test that:
- Clicking a movie card navigates to detail page
- Movie details load and display correctly
- Favorite button works (add/remove)
- Favorites persist after page refresh
- Favorites page shows saved movies
- Navigation works correctly

---

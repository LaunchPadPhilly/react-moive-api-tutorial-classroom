
## 🔍 Milestone 2: Search Flow Implementation (1-2 days)

### Step 7: Create API Service

Create `src/services/omdbApi.js`:
```javascript
const API_KEY = import.meta.env.VITE_OMDB_API_KEY;
const BASE_URL = 'https://www.omdbapi.com/';

export const omdbApi = {
  async searchMovies(query, page = 1, type, year) {
    const params = new URLSearchParams({
      apikey: API_KEY,
      s: query,
      page: page.toString(),
    });

    if (type && type !== 'all') {
      params.append('type', type);
    }
    
    if (year) {
      params.append('y', year);
    }

    const response = await fetch(`${BASE_URL}?${params}`);
    
    if (!response.ok) {
      throw new Error('Network response was not ok');
    }

    const data = await response.json();

    if (data.Response === 'False') {
      if (data.Error === 'Movie not found!') {
        return { results: [], totalResults: 0 };
      }
      throw new Error(data.Error || 'Search failed');
    }

    return {
      results: data.Search || [],
      totalResults: parseInt(data.totalResults || '0', 10),
    };
  },

  async getMovieDetails(imdbID) {
    const params = new URLSearchParams({
      apikey: API_KEY,
      i: imdbID,
      plot: 'full',
    });

    const response = await fetch(`${BASE_URL}?${params}`);
    
    if (!response.ok) {
      throw new Error('Network response was not ok');
    }

    const data = await response.json();

    if (data.Response === 'False') {
      throw new Error(data.Error || 'Movie not found');
    }

    return data;
  },
};
```

### Step 9: Create Custom Hooks

Create `src/hooks/useMovieSearch.js`:
```javascript
import { useQuery } from '@tanstack/react-query';
import { omdbApi } from '../services/omdbApi';

export const useMovieSearch = (query, page = 1, type, year) => {
  return useQuery({
    queryKey: ['search', query, page, type, year],
    queryFn: () => omdbApi.searchMovies(query, page, type, year),
    enabled: query.length >= 2,
    staleTime: 1000 * 60, // 1 minute
  });
};
```

Create `src/hooks/useDebounce.js`:
```javascript
import { useState, useEffect } from 'react';

export const useDebounce = (value, delay) => {
  const [debouncedValue, setDebouncedValue] = useState(value);

  useEffect(() => {
    const handler = setTimeout(() => {
      setDebouncedValue(value);
    }, delay);

    return () => {
      clearTimeout(handler);
    };
  }, [value, delay]);

  return debouncedValue;
};
```

### Step 10: Create Search Components

Create `src/styles/SearchBar.css`:
```css
.search-form {
  position: relative;
}

.search-input-container {
  position: relative;
}

.search-icon-container {
  position: absolute;
  top: 0;
  left: 0;
  bottom: 0;
  padding-left: 0.75rem;
  display: flex;
  align-items: center;
  pointer-events: none;
}

.search-icon {
  width: 1.25rem;
  height: 1.25rem;
  color: #9ca3af;
}

.search-input {
  display: block;
  width: 100%;
  padding: 0.75rem 2.5rem 0.75rem 2.5rem;
  border: 1px solid #d1d5db;
  border-radius: 0.375rem;
  font-size: 0.875rem;
  line-height: 1.25;
  background-color: white;
  color: #111827;
  transition: all 0.2s ease;
}

.search-input::placeholder {
  color: #6b7280;
}

.search-input:focus {
  outline: none;
  border-color: #3b82f6;
  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

.search-input:focus::placeholder {
  color: #9ca3af;
}

.search-input:disabled {
  background-color: #f3f4f6;
  color: #6b7280;
}

.clear-button-container {
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  padding-right: 0.75rem;
  display: flex;
  align-items: center;
}

.clear-button {
  color: #9ca3af;
  background: none;
  border: none;
  padding: 0.25rem;
  border-radius: 0.25rem;
  cursor: pointer;
  transition: color 0.2s ease;
}

.clear-button:hover {
  color: #6b7280;
}

.clear-button:focus {
  outline: none;
  box-shadow: 0 0 0 2px #3b82f6;
}

.clear-icon {
  width: 1.25rem;
  height: 1.25rem;
}
```

Create `src/components/SearchBar.jsx`:
```jsx
import { useState, useEffect } from 'react';
import { MagnifyingGlassIcon, XMarkIcon } from '@heroicons/react/24/outline';
import '../styles/SearchBar.css';

export default function SearchBar({
  value,
  onChange,
  onClear,
  placeholder = "Search for movies...",
  disabled = false
}) {
  const [localValue, setLocalValue] = useState(value);

  useEffect(() => {
    setLocalValue(value);
  }, [value]);

  const handleSubmit = (e) => {
    e.preventDefault();
    onChange(localValue);
  };

  const handleClear = () => {
    setLocalValue('');
    onClear();
  };

  return (
    <form onSubmit={handleSubmit} className="search-form">
      <div className="search-input-container">
        <div className="search-icon-container">
          <MagnifyingGlassIcon className="search-icon" aria-hidden="true" />
        </div>
        <input
          type="text"
          value={localValue}
          onChange={(e) => setLocalValue(e.target.value)}
          placeholder={placeholder}
          disabled={disabled}
          className="search-input"
          aria-label="Search movies"
        />
        {localValue && (
          <div className="clear-button-container">
            <button
              type="button"
              onClick={handleClear}
              className="clear-button"
              aria-label="Clear search"
            >
              <XMarkIcon className="clear-icon" />
            </button>
          </div>
        )}
      </div>
    </form>
  );
}
```

Create `src/styles/MovieCard.css`:
```css
.movie-card {
  background: white;
  border-radius: 0.5rem;
  box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
  overflow: hidden;
  transition: box-shadow 0.2s ease;
  text-decoration: none;
  color: inherit;
  display: block;
}

.movie-card:hover {
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
}

.movie-card:focus {
  outline: none;
  box-shadow: 0 0 0 2px #3b82f6;
}

.movie-poster-container {
  aspect-ratio: 2/3;
  background-color: #f3f4f6;
  position: relative;
}

.movie-poster {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.movie-poster-placeholder {
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #6b7280;
}

.movie-poster-placeholder-content {
  text-align: center;
}

.movie-poster-placeholder-icon {
  font-size: 2.5rem;
  margin-bottom: 0.5rem;
}

.movie-poster-placeholder-text {
  font-size: 0.875rem;
}

.movie-info {
  padding: 1rem;
}

.movie-title {
  font-weight: 600;
  color: #111827;
  font-size: 0.875rem;
  margin-bottom: 0.25rem;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

.movie-meta {
  color: #6b7280;
  font-size: 0.875rem;
}
```

Create `src/components/MovieCard.jsx`:
```jsx
import { Link } from 'react-router-dom';
import '../styles/MovieCard.css';

export default function MovieCard({ movie }) {
  const posterUrl = movie.Poster !== 'N/A' ? movie.Poster : null;

  return (
    <Link
      to={`/movie/${movie.imdbID}`}
      className="movie-card"
    >
      <div className="movie-poster-container">
        {posterUrl ? (
          <img
            src={posterUrl}
            alt={`${movie.Title} poster`}
            className="movie-poster"
            loading="lazy"
          />
        ) : (
          <div className="movie-poster-placeholder">
            <div className="movie-poster-placeholder-content">
              <div className="movie-poster-placeholder-icon">🎬</div>
              <div className="movie-poster-placeholder-text">No Poster</div>
            </div>
          </div>
        )}
      </div>
      <div className="movie-info">
        <h3 className="movie-title">
          {movie.Title}
        </h3>
        <p className="movie-meta">
          {movie.Year} • {movie.Type}
        </p>
      </div>
    </Link>
  );
}
```

Create `src/components/LoadingSpinner.jsx`:
```jsx
export default function LoadingSpinner() {
  return (
    <div className="flex justify-center items-center" style={{ padding: '2rem 0' }}>
      <div className="spinner"></div>
      <span style={{ marginLeft: '0.5rem', color: '#6b7280' }}>Loading...</span>
    </div>
  );
}
```

Create `src/styles/SearchPage.css`:
```css
.search-page {
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
}

.search-header h1 {
  font-size: 1.875rem;
  font-weight: 700;
  color: #111827;
  margin-bottom: 1.5rem;
}

.error-message {
  background-color: #fef2f2;
  border: 1px solid #fecaca;
  border-radius: 0.375rem;
  padding: 1rem;
}

.error-text {
  color: #991b1b;
}

.results-info {
  margin-bottom: 1rem;
  color: #6b7280;
}

.results-grid {
  display: grid;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 1rem;
}

@media (min-width: 640px) {
  .results-grid {
    grid-template-columns: repeat(3, minmax(0, 1fr));
  }
}

@media (min-width: 768px) {
  .results-grid {
    grid-template-columns: repeat(4, minmax(0, 1fr));
  }
}

@media (min-width: 1024px) {
  .results-grid {
    grid-template-columns: repeat(5, minmax(0, 1fr));
  }
}

.load-more-container {
  margin-top: 2rem;
  text-align: center;
}

.load-more-btn {
  background-color: #3b82f6;
  color: white;
  padding: 0.5rem 1.5rem;
  border-radius: 0.375rem;
  border: none;
  cursor: pointer;
  font-weight: 500;
  transition: background-color 0.2s ease;
}

.load-more-btn:hover:not(:disabled) {
  background-color: #2563eb;
}

.load-more-btn:focus {
  outline: none;
  box-shadow: 0 0 0 2px #3b82f6;
}

.load-more-btn:disabled {
  background-color: #9ca3af;
  cursor: not-allowed;
}

.empty-state {
  text-align: center;
  padding: 3rem 0;
}

.empty-state-icon {
  font-size: 3.75rem;
  margin-bottom: 1rem;
}

.empty-state-title {
  font-size: 1.125rem;
  font-weight: 500;
  color: #111827;
  margin-bottom: 0.5rem;
}

.empty-state-text {
  color: #6b7280;
}
```

Update `src/pages/SearchPage.jsx`:
```jsx
import { useState, useEffect } from 'react';
import { useSearchParams } from 'react-router-dom';
import SearchBar from '../components/SearchBar';
import MovieCard from '../components/MovieCard';
import LoadingSpinner from '../components/LoadingSpinner';
import { useMovieSearch } from '../hooks/useMovieSearch';
import { useDebounce } from '../hooks/useDebounce';
import '../styles/SearchPage.css';

export default function SearchPage() {
  const [searchParams, setSearchParams] = useSearchParams();
  const [query, setQuery] = useState(searchParams.get('q') || '');
  const [page, setPage] = useState(1);
  const debouncedQuery = useDebounce(query, 500);

  const { data, isLoading, error, isError } = useMovieSearch(debouncedQuery, page);

  useEffect(() => {
    if (debouncedQuery) {
      setSearchParams({ q: debouncedQuery });
    } else {
      setSearchParams({});
    }
  }, [debouncedQuery, setSearchParams]);

  const handleSearch = (newQuery) => {
    setQuery(newQuery);
    setPage(1);
  };

  const handleClear = () => {
    setQuery('');
    setPage(1);
  };

  const handleLoadMore = () => {
    setPage(prev => prev + 1);
  };

  const totalPages = data ? Math.ceil(data.totalResults / 10) : 0;
  const hasMore = page < totalPages;

  return (
    <div className="search-page">
      <div className="search-header">
        <h1>Discover Movies</h1>
        <SearchBar
          value={query}
          onChange={handleSearch}
          onClear={handleClear}
          disabled={isLoading}
        />
      </div>

      {isLoading && <LoadingSpinner />}

      {isError && (
        <div className="error-message">
          <div className="error-text">
            <strong>Error:</strong> {error?.message || 'Something went wrong'}
          </div>
        </div>
      )}

      {data && data.results.length > 0 && (
        <div>
          <div className="results-info">
            Found {data.totalResults} results
          </div>
          <div className="results-grid">
            {data.results.map((movie) => (
              <MovieCard key={movie.imdbID} movie={movie} />
            ))}
          </div>
          
          {hasMore && (
            <div className="load-more-container">
              <button
                onClick={handleLoadMore}
                disabled={isLoading}
                className="load-more-btn"
              >
                {isLoading ? 'Loading...' : 'Load More'}
              </button>
            </div>
          )}
        </div>
      )}

      {data && data.results.length === 0 && debouncedQuery && (
        <div className="empty-state">
          <div className="empty-state-icon">🔍</div>
          <h3 className="empty-state-title">
            No movies found
          </h3>
          <p className="empty-state-text">
            Try searching with different keywords
          </p>
        </div>
      )}

      {!debouncedQuery && (
        <div className="empty-state">
          <div className="empty-state-icon">🎬</div>
          <h3 className="empty-state-title">
            Search for movies
          </h3>
          <p className="empty-state-text">
            Enter a movie title to get started
          </p>
        </div>
      )}
    </div>
  );
}
```

### Step 12: Test Search Functionality

```bash
npm run dev
```

Test that:
- Search input is debounced (waits 500ms after typing)
- Results display in a responsive grid
- Loading states work correctly
- Error handling works (try invalid API key)
- URL updates with search query
- Load more pagination works

**Note:** The remaining components (MovieDetailPage, FavoritesPage, FavoriteButton, ErrorBoundary, etc.) will need similar CSS3 styling updates. Follow the same pattern:

1. Create a corresponding CSS file in `src/styles/`
2. Replace Tailwind classes with custom CSS classes
3. Import the CSS file in the component
4. Use semantic class names that describe the component's purpose

For example, replace Tailwind classes like:
- `className="text-xl font-bold text-gray-900"` → `className="page-title"`
- `className="bg-blue-600 text-white px-4 py-2 rounded-md"` → `className="btn btn-primary"`
- `className="flex items-center justify-between"` → `className="flex items-center justify-between"`

You can use the utility classes already defined in `src/index.css` or create component-specific styles as needed.

---
